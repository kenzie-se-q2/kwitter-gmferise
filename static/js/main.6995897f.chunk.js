(this["webpackJsonpkwitter-starter"]=this["webpackJsonpkwitter-starter"]||[]).push([[0],{147:function(e,t,n){},156:function(e,t,n){},160:function(e,t,n){},161:function(e,t,n){},162:function(e,t,n){},163:function(e,t,n){},164:function(e,t,n){},165:function(e,t,n){},166:function(e,t,n){},167:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),s=n(53),r=n.n(s),o=(n(147),n(24)),i=n(10),u=(n(148),n(21)),d=n(13),l=n(126),j=n(114),b={user:{token:""},messages:[],toast:{message:"",statusCode:0}},h="LOGIN",p="LOGOUT",f="TOAST",O="UNTOAST",m="UPDATE_MESSAGES",x="RESET_MESSAGES",g=function(e,t){var n,a,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{message:(null===(n=e.payload)||void 0===n?void 0:n.message)||t,statusCode:(null===(a=e.payload)||void 0===a?void 0:a.statusCode)||c}},v=Object(l.a)(Object(j.devtools)(Object(j.redux)((function(e,t){switch(t.type){case h:return{user:t.payload,toast:g(t,"Successfully logged in as ".concat(t.payload.username))};case p:return{user:b.user,toast:g(t,"Log out successful",200)};case f:return{toast:Object(d.a)(Object(d.a)({},e.toast),t.payload)};case O:return{toast:b.toast};case m:return{messages:t.payload};case x:return{messages:b.messages};default:return e}}),b))),y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"You must be signed in to view this page",t=v(),n=t.dispatch,c=t.user,s=Object(i.g)();Object(a.useEffect)((function(){c.token||(n({type:f,payload:{message:e,statusCode:1}}),s.replace("/login"))}),[c])},w="https://socialapp-api.herokuapp.com/",C=function(e,t){return fetch("".concat(w,"auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then((function(e){return e.json()}))},N=function(e){return fetch("".concat(w,"users/").concat(e),{method:"GET"}).then((function(e){return e.json()}))},S=n(184),k=n(168),E=n(58),T=n(80),A=(n(156),{usePolling:function(e,t){return Object(a.useEffect)((function(){t();var n=setInterval(t,e);return function(){clearInterval(n)}}),[]),function(e){for(var n,a=arguments.length,c=new Array(a>1?a-1:0),s=1;s<a;s++)c[s-1]=arguments[s];null===(n=e.apply(void 0,c))||void 0===n||n.then(t)}},Context:Object(a.createContext)((function(){}))}),P=n(2);var F=function(e){var t=Object(a.useState)({displayName:"",picture:"./default.png"}),n=Object(u.a)(t,2),c=n[0],s=n[1],r=v((function(e){return e.user})),o=Object(a.useContext)(A.Context),i=e.likes.find((function(e){return e.username===r.username})),d=!!i;Object(a.useEffect)((function(){N(e.username).then((function(e){200===e.statusCode&&s((function(t){return{displayName:e.user.displayName,picture:e.user.pictureLocation?w.slice(0,-1)+e.user.pictureLocation:t.picture}}))}))}),[]);var l=function(){return d?(t=i.id,n=r.token,fetch("".concat(w,"likes/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}}).then((function(e){return e.json()}))):function(e,t){return fetch("".concat(w,"likes"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({messageId:e})}).then((function(e){return e.json()}))}(e.id,r.token);var t,n};return Object(P.jsxs)(S.a,{compact:!0,id:"message",children:[Object(P.jsxs)("div",{id:"user-info",children:[Object(P.jsx)("img",{className:"user-image",src:c.picture}),Object(P.jsx)("div",{children:Object(P.jsxs)(S.a.Header,{children:[Object(P.jsx)("span",{children:c.displayName})," ",Object(P.jsx)("br",{})," ",Object(P.jsxs)("span",{children:["@",e.username]})]})})]}),Object(P.jsx)("div",{id:"content",children:Object(P.jsx)("p",{children:e.text})}),Object(P.jsxs)(k.a,{as:"div",id:"like-button",labelPosition:"right",children:[Object(P.jsxs)(k.a,{className:d?"liked":"",icon:!0,type:"button",onClick:function(){return o(l)},children:[Object(P.jsx)(E.a,{name:"heart"}),"Like"]}),Object(P.jsx)(T.a,{as:"a",basic:!0,pointing:"left",children:e.likeCount})]})]})};var L=function(){var e=v((function(e){return e.messages}));return Object(P.jsx)("div",{className:"MsgList",children:e.map((function(e){return Object(a.createElement)(F,Object(d.a)(Object(d.a)({},e),{},{key:e.id,likeCount:e.likes.length}))}))})},D=n(183),U=n(182);n(160);var B=function(){var e=v((function(e){return e.user})),t=v((function(e){return e.dispatch})),n=Object(a.useState)(""),c=Object(u.a)(n,2),s=c[0],r=c[1];y("Please sign in to start chatting!");var o=A.usePolling(5e3,(function(){var e,n;(e=10,n=0,fetch("".concat(w,"messages?limit=").concat(e,"&offset=").concat(n),{method:"GET"}).then((function(e){return e.json()}))).then((function(e){200===e.statusCode&&t({type:m,payload:e.messages})}))})),i=function(t){return t.preventDefault(),(n=s,a=e.token,fetch("".concat(w,"messages"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({text:n})}).then((function(e){return e.json()}))).then((function(e){200===e.statusCode&&r("")}));var n,a};return Object(P.jsx)("div",{className:"home-view",children:Object(P.jsxs)(A.Context.Provider,{value:o,children:[Object(P.jsx)(L,{}),Object(P.jsx)(D.a,{className:"draftbox",onSubmit:function(e){return o(i,e)},children:Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)(U.a,{rows:3,value:s,placeholder:"Draft a message here...",onChange:function(e){r(e.target.value)}}),Object(P.jsx)(k.a,{variant:"secondary",type:"submit",children:"Send"})]})})]})})};n(161);var G=function(){return Object(P.jsx)("div",{id:"error-page",children:Object(P.jsx)("img",{src:"https://cdn.dribbble.com/users/722246/screenshots/3066818/404-page.gif"})})},z=n(38);n(162);var J=function(){var e=v((function(e){return e.dispatch})),t=Object(i.g)(),n=Object(a.useState)({username:"",password:""}),c=Object(u.a)(n,2),s=c[0],r=c[1],l=function(e){r((function(t){return Object(d.a)(Object(d.a)({},t),{},Object(z.a)({},e.target.name,e.target.value))}))};return Object(P.jsx)("div",{className:"colorbg",children:Object(P.jsxs)("div",{id:"login-form",children:[Object(P.jsx)("h1",{children:"Login"}),Object(P.jsxs)(D.a,{onSubmit:function(n){n.preventDefault(),C(s.username,s.password).then((function(n){e({type:h,payload:n}),200===n.statusCode&&t.push("/")}))},children:[Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{htmlFor:"username",children:"Username"}),Object(P.jsx)("input",{type:"text",name:"username",value:s.username,autoFocus:!0,required:!0,onChange:l,pattern:".{3,}"})]}),Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{htmlFor:"password",children:"Password"}),Object(P.jsx)("input",{type:"password",name:"password",value:s.password,required:!0,onChange:l})]}),Object(P.jsx)(k.a,{type:"submit",children:"Submit"})]}),Object(P.jsx)("hr",{}),Object(P.jsx)(o.b,{to:"/signup",children:Object(P.jsx)(k.a,{id:"create-account",type:"button",children:"Create New Account"})})]})})},q=(n(163),function(){var e=v((function(e){return e.dispatch})),t=v((function(e){return e.user})),n=Object(a.useState)({username:"",displayName:"",password:""}),c=Object(u.a)(n,2),s=c[0],r=c[1],o=function(e){var t=e.target.name,n=e.target.value;r((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(z.a)({},t,n))}))};return Object(P.jsxs)("div",{className:"colorbg",children:[t.token&&Object(P.jsx)(i.a,{to:"/"}),Object(P.jsxs)("div",{id:"newaccount-form",children:[Object(P.jsx)("h1",{children:"Sign Up"}),Object(P.jsxs)(D.a,{onSubmit:function(t){var n,a,c;t.preventDefault(),(n=s.username,a=s.displayName,c=s.password,fetch("".concat(w,"users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,displayName:a,password:c})}).then((function(e){return e.json()}))).then((function(){return C(s.username,s.password)})).then((function(t){return e({type:h,payload:t})}))},children:[Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"Username"}),Object(P.jsx)("input",{type:"text",name:"username",value:s.username,autoFocus:!0,required:!0,onChange:o,pattern:".{3,}",placeholder:"Username"})]}),Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"Display Name"}),Object(P.jsx)("input",{type:"text",name:"displayName",value:s.displayName,autoFocus:!0,required:!0,onChange:o,pattern:".{3,}",placeholder:"Display Name"})]}),Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"Password"}),Object(P.jsx)("input",{type:"password",name:"password",value:s.password,autoFocus:!0,required:!0,onChange:o,pattern:".{3,}",placeholder:"Password"})]}),Object(P.jsx)(k.a,{type:"submit",children:"Submit"})]})]})]})}),I=n(181);n(164);var M=function(){var e=v((function(e){return e.dispatch})),t=v((function(e){return e.user})),n=Object(a.useState)("./default.png"),c=Object(u.a)(n,2),s=c[0],r=c[1],o=function(){var e;(e=t.username,fetch("".concat(w,"users/").concat(e,"/picture"),{method:"GET"}).then((function(e){return e.ok?e.blob():null})).then((function(e){return e?URL.createObjectURL(e):null}))).then((function(e){return e&&r(e)}))};return Object(a.useEffect)(o,[t]),Object(P.jsxs)("div",{className:"currentImage",children:[Object(P.jsx)("img",{src:s}),Object(P.jsx)("input",{type:"file",onChange:function(n){n.target.files.length&&function(e,t,n){var a=new FormData;return a.append("picture",t),fetch("".concat(w,"users/").concat(e,"/picture"),{method:"PUT",headers:{Authorization:"Bearer ".concat(n)},body:a}).then((function(e){return e.json()}))}(t.username,n.target.files[0],t.token).then((function(t){200===t.statusCode?(e({type:f,payload:{message:"Successfully updated profile picture",statusCode:200}}),o()):e({type:f,payload:t})}))}})]})};var R=function(){var e=v((function(e){return e.user})),t=v((function(e){return e.dispatch})),n=Object(i.g)(),c=Object(a.useState)({displayName:"",about:"",password:"",picture:""}),s=Object(u.a)(c,2),r=s[0],o=s[1];y("You must be signed in to edit your profile");var l=function(){e.username&&N(e.username).then((function(e){o((function(t){return Object(d.a)(Object(d.a)({},t),{},{displayName:e.user.displayName,about:e.user.about,password:""})}))}))};Object(a.useEffect)(l,[e]);var j=function(e){var t=e.target.name,n=e.target.value;o((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(z.a)({},t,n))}))};return Object(P.jsxs)("div",{className:"profile",children:[Object(P.jsx)("h1",{children:"Edit Profile"}),Object(P.jsx)(M,{}),Object(P.jsx)("div",{id:"delete-button",children:Object(P.jsx)(k.a,{basic:!0,color:"red",type:"button",onClick:function(){var a,c;(a=e.username,c=e.token,fetch("".concat(w,"users/").concat(a),{method:"DELETE",headers:{Authorization:"Bearer ".concat(c)}}).then((function(e){return e.json()}))).then((function(e){200===e.statusCode&&(n.push("/login"),t({type:p}),t({type:f,payload:{message:"Account successfully deleted",statusCode:2}}))}))},children:"Delete Account"})}),Object(P.jsx)("div",{className:"profile-form",children:Object(P.jsxs)(D.a,{id:"update-user",onSubmit:function(n){var a,c,s,o,i;n.preventDefault(),(a=e.username,c=r.password,s=r.displayName,o=r.about,i=e.token,fetch("".concat(w,"users/").concat(a),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(Object(d.a)(Object(d.a)({},{displayName:s,about:o}),c?{password:c}:{}))}).then((function(e){return e.json()}))).then((function(){l(),t({type:f,payload:{message:"Successfully updated profile",statusCode:200}})}))},children:[Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"Display Name *"}),Object(P.jsx)(I.a,{name:"displayName",placeholder:"Display Name",value:r.displayName,required:!0,pattern:".{3,}",onChange:j})]}),Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"About Me (Optional)"}),Object(P.jsx)(U.a,{name:"about",placeholder:"About",value:r.about,onChange:j})]}),Object(P.jsxs)(D.a.Field,{children:[Object(P.jsx)("label",{children:"New Password (Optional)"}),Object(P.jsx)(I.a,{placeholder:"New Password",name:"password",value:r.password,type:"password",pattern:".{3,}",onChange:j})]}),Object(P.jsx)(k.a,{type:"submit",children:"Update Profile"})]})})]})};n(165);var H=function(){var e=v((function(e){return e.user})),t=v((function(e){return e.dispatch})),n=Object(i.g)();return Object(P.jsxs)("div",{id:"nav-bar",children:[Object(P.jsx)(k.a,{id:"nav-back-button",onClick:n.goBack,children:"Back"}),Object(P.jsx)("h1",{className:"site-title",children:"Bitter"}),Object(P.jsx)("div",{id:"nav-buttons",children:e.token?Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(o.b,{to:"/",children:"Chat"}),Object(P.jsx)(o.b,{to:"/profile",children:"Edit Profile"}),Object(P.jsx)("a",{onClick:function(){var a;(a=e.token,fetch("".concat(w,"auth/logout"),{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json()}))).then((function(){n.push("/login"),t({type:"LOGOUT"})}))},children:"Logout"})]}):Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(o.b,{to:"/login",children:"Login"}),Object(P.jsx)(o.b,{to:"/signup",children:"Sign Up"})]})})]})},Y=(n(166),function(){var e=v((function(e){return e.dispatch})),t=v((function(e){return e.toast})),n=(null===t||void 0===t?void 0:t.message)?"toast-show":"";return Object(a.useEffect)((function(){var n=null;return t.message&&(n=setTimeout((function(){return e({type:O})}),1500)),function(){clearTimeout(n)}}),[t]),Object(P.jsx)("div",{className:"toast toast-".concat(t.statusCode," ").concat(n),children:Object(P.jsx)("p",{children:t.message})})});var _=function(){var e=Object(i.g)();return window.show404=function(){return e.push("/404")},Object(P.jsxs)("div",{className:"App",children:[Object(P.jsx)(Y,{}),Object(P.jsx)(H,{}),Object(P.jsxs)(i.d,{children:[Object(P.jsx)(i.b,{exact:!0,path:"/",component:B}),Object(P.jsx)(i.b,{path:"/login",component:J}),Object(P.jsx)(i.b,{path:"/signup",component:q}),Object(P.jsx)(i.b,{exact:!0,path:"/profile",component:R}),Object(P.jsx)(i.b,{component:G})]})]})};r.a.render(Object(P.jsx)(c.a.StrictMode,{children:Object(P.jsx)(o.a,{basename:"/kwitter-gmferise",children:Object(P.jsx)(_,{})})}),document.getElementById("root"))}},[[167,1,2]]]);
//# sourceMappingURL=main.6995897f.chunk.js.map